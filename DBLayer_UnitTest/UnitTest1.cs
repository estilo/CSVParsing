using System;
using System.Linq;
using DBLayer;
using DBLayer.DBServices;
using DBLayer.Models;
using Microsoft.VisualStudio.TestTools.UnitTesting;
using NHibernate;

namespace UnitTestProject1
{
    [TestClass]
    public class UnitTest1
    {
        private ISessionFactory sessionFactory;
        private CrudDbServices crudDbServices;

        [TestInitialize()]
        public void Intialize()
        {
            sessionFactory = Plumbing.CreateSessionFactory();
            crudDbServices = new CrudDbServices(sessionFactory);
        }


        [TestMethod]
        public void EmployeeInsert()
        {
            try
            {
                Employee e1 = new Employee();

                e1.FirstName = "Tom";
                e1.LastName = "Hanks-" + Guid.NewGuid().ToString();

                crudDbServices.SaveOrUpdate(e1);
            }
            catch (Exception ex)
            {
                Assert.Fail("Exception : " + ex.Message);
            }
        }

        [TestMethod]
        public void EmployeeUpdate()
        {
            string guid2Search = "383807be-b3e2-49b5-bd72-a584016f4878";
            Employee e1 = new Employee();
            e1.Id = new Guid(guid2Search);
            e1.FirstName = "Tom";
            e1.LastName = "Cruse-" + Guid.NewGuid().ToString();
            crudDbServices.SaveOrUpdate(e1);

            var employee = crudDbServices.FindEmployeeById(new Guid(guid2Search));
            if (employee != null)
            {
                Assert.IsTrue(employee.LastName.Equals(e1.LastName, StringComparison.InvariantCultureIgnoreCase));
            }
            else
            {
                Assert.Fail("No data in table error");
            }
        }

        [TestMethod]
        public void FindEmployeeById()
        {
            var employee = crudDbServices.FindEmployeeById(new Guid("26477497-24fa-4d32-97ed-a5840172b082"));
            if (employee == null || employee == default(Employee))
            {
                Assert.Fail("No data in table error");
            }
            else
            {
                Assert.IsTrue( employee.FirstName.Equals("Tom",StringComparison.InvariantCultureIgnoreCase));
                Assert.IsTrue(employee.LastName.Equals("Cruse", StringComparison.InvariantCultureIgnoreCase));
            }
        }

        [TestMethod]
        public void DeleteRecords()
        {
            var employee = crudDbServices.FindEmployeeById(new Guid("be043094-d5b3-4ed5-a1bc-a5840182c6a9"));
            if (employee == null)
            {
                Assert.Fail("Couldnt retrieve record for deletion");
            }
            else
            {
                
                try                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
                {
                    crudDbServices.DeleteEmployee(employee);
                }
                catch (Exception ex)
                {
                    Assert.Fail("Exception : " + ex.Message);
                }
            }

        }

        [TestMethod]
        public void GetAllEmployee()
        {
            //var crudDbServices = new CrudDbServices(sessionFactory);
            var allEmployees = crudDbServices.GetAllEmployees();
            if(allEmployees==null || !allEmployees.Any())
                Assert.Fail("No data in table error");
        }
    }
}